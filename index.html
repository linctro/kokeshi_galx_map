<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Conpatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>こけしgalxマップ</title>
  <link rel="stylesheet" href="./resource/styles/destyle.css" />
  <link rel="stylesheet" href="./resource/styles/style.css" />

</head>

<body>
  <div id="tower-panel">
    <h1>Kokeshi Tower</h1>
    <div id="kokeshi-tower"></div>
  </div>

  <script>
    // Backendlessの設定
    const APP_ID = "F836FFE2-AA5B-8A23-FF17-4DA921B9C900"; // BackendlessアプリID
    const API_KEY = "2AD3A779-0802-4F6E-BC18-ED592E6BEAC1"; // REST APIキー
    //const objectId = "791E7404-AC37-4598-9B04-044FD5A2C9F9";

    const DATABASE_URL = `https://api.backendless.com/${APP_ID}/${API_KEY}/data/tower`;

    const leaderboardPanel = document.getElementById("leaderboard");
    const towerPanel = document.getElementById("tower-panel");
    const towerContainer = document.getElementById("kokeshi-tower");
    const popup = document.getElementById("user-popup");
    const popupName = document.getElementById("popup-name");
    const popupHeight = document.getElementById("popup-height");
    const popupSns = document.getElementById("popup-sns");
    const popupClose = document.getElementById("popup-close");

    const BACKGROUND_THRESHOLDS = [
      { limit: 100, className: "background-earth" },
      { limit: 300, className: "background-tokyo-tower" },
      { limit: 600, className: "background-mt-fuji" },
      { limit: Infinity, className: "background-space" },
    ];


    // Build kokeshi tower
    function buildKokeshiTower(count) {
      towerContainer.innerHTML = "";
      for (let i = 0; i < count; i++) {
        const kokeshi = document.createElement("div");
        kokeshi.classList.add("kokeshi");

        const face = document.createElement("div");
        face.classList.add("kokeshi-face");

        kokeshi.appendChild(face);
        towerContainer.appendChild(kokeshi);
      }

      updateBackground(count);
    }

    function updateBackground(count) {
      towerPanel.className = BACKGROUND_THRESHOLDS.find(
        (threshold) => count <= threshold.limit
      ).className;
    }

    // Fetch stuck data and build tower
    async function fetchAndBuildKokeshiTower(objectId) {
      try {
        const response = await fetch(`${DATABASE_URL}/${objectId}`, {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
        });

        if (!response.ok) {
          throw new Error(`Error fetching data: ${response.statusText}`);
        }

        const data = await response.json();
        buildKokeshiTower(data.stuck);
      } catch (error) {
        console.error("Failed to fetch stuck data:", error);
      }
    }

    // Example usage
    fetchAndBuildKokeshiTower("791E7404-AC37-4598-9B04-044FD5A2C9F9");

  </script>
</body>

</html>